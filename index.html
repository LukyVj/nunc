<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title>nunc</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:css({.tmp,app}) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->

    <!-- build:js scripts/vendor/modernizr.js -->
    <script src="bower_components/modernizr/modernizr.js"></script>
    <!-- endbuild -->

    <style>
       .join {
        display: inline;
    }
    .quit {
        display: none;
    }
    video {
        float left;
        margin: 10px;
        width: 300px;
    }
</style>
</head>
<body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
            <![endif]-->

            <div class="container">
              <div>
                <input type="button" value="Join Conference" onclick="joinRoom();" class="join" \>
                <input type="button" value="Quit Conference" onclick="quitRoom();" class="quit" \>
            </div>
            <div class="video-container"></div>
        </div>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
                function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>

        <!-- build:js scripts/vendor.js -->
        <!-- bower:js -->
        <script src="bower_components/jquery/dist/jquery.js"></script>
        <!-- endbower -->
        <!-- endbuild -->

        <!-- build:js scripts/plugins.js -->
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/affix.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/alert.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/dropdown.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/tooltip.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/modal.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/transition.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/button.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/popover.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/carousel.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/scrollspy.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/collapse.js"></script>
        <script src="bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/tab.js"></script>
        <!-- endbuild -->

        <!-- build:js scripts/main.js -->
        <script src="scripts/main.js"></script>
        <!-- endbuild -->

        <script type='text/javascript' src="https://api.bistri.com/bistri.conference.min.js"></script>

        <script>
         /*
 * Need some explanations about this code ? Take a look at our API tutorial:
 * https://api.developers.bistri.com/tutorial
 */

 onBistriConferenceReady = function () {

    var room = "myMeetingRoom";

    // at first we test if the browser is WebRTC enable
    if (!BistriConference.isCompatible()) {
        alert("your browser is not WebRTC compatible !");
        return;
    }

    window.localStreamReady = false;

    /*
     * this is the function called when the button "Join Conference" is pressed
     */
     window.joinRoom = function () {

        // if the local stream (webcam) is ready 
        if (!window.localStreamReady) {
            alert("local media is not ready");
            return;
        }

        // then when are ready to join the conference room called "myMeetingRoom"
        BistriConference.joinRoom(room);
    };

    /*
     * this is the function called when the button "Quit Conference" is pressed
     */
     window.quitRoom = function () {

        // We stop calls with all conference room members
        BistriConference.endCalls(room);

        // then we quit the conference room
        BistriConference.quitRoom(room);
    };

    /*
     * API is initialized with personal keys
     * To get your own keys, go to https://api.developers.bistri.com/login
     * debug is set to true to print some logs in the javascript console
     */
     BistriConference.init({
        // don't forget to replace the following keys by your own
        appId: "27194309",
        appKey: "4f1d6149dde5df8b093e49ff787b3867",
        debug: true
    });

    /*
     * we add a handler to manage "onConnected" event triggered by the signaling server
     * this event occurs when user is connected to the signaling server
     */
     BistriConference.signaling.addHandler("onConnected", function () {

        // we are now connected to the signaling server, 
        // we can request access to the user webcam
        BistriConference.startStream("webcamSD",function(localStream){

            window.localStreamReady = true;
            
            var node = document.querySelector('.video-container');

            // we "insert" the local video stream into a container
            BistriConference.attachStream(localStream, node, {
                // video auto start after being inserted
                autoplay: true,
                // video switch to fullscreen when user click on it
                fullscreen: true
            });
        });
    });

    /*
     * we add a handler to manage "onJoinedRoom" event triggered by the signaling server
     * this event occurs when user join the conference room
     */
     BistriConference.signaling.addHandler("onJoinedRoom", function (result) {

        // we entered the conference room.
        // we request a call start with every single member already present in the room
        var roomMembers = result.members;
        for (var i = 0; i < roomMembers.length; i++) {
            BistriConference.call(roomMembers[i].id,room);
        }

        // we hide "Join Conference" button
        document.querySelector(".join").style.display = "none";

        //  and show "Quit Conference" button
        document.querySelector(".quit").style.display = "inline";
    });

    /*
     * we add a handler to manage "onJoinRoomError" event triggered by the signaling server
     * this event occurs when user fails to join the conference room
     */
     BistriConference.signaling.addHandler("onJoinRoomError", function (error) {

        // we can't handle more than 4 participants in a same room (for performance issue) 
        alert(error.text+" ("+error.code+")" );
    });

    /*
     * we add a handler to manage "onQuittedRoom" event triggered by the signaling server
     * this event occurs when user has quitted the conference room
     */
     BistriConference.signaling.addHandler("onQuittedRoom", function (data) {

        // we hide "Quit Conference" button
        document.querySelector(".quit").style.display = "none";

        // and we show "Join Conference" button
        document.querySelector(".join").style.display = "inline";

    });

    /*
     * we add a handler to manage "onStreamAdded" event triggered by the stream manager
     * this event occurs when a local or remote video stream is received
     */
     BistriConference.streams.addHandler("onStreamAdded", function (remoteStream, pid) {

       var node = document.querySelector('.video-container');

        // we "insert" the video stream into a container
        BistriConference.attachStream(remoteStream, node, {
            // video auto start after being inserted
            autoplay: true,
            // video switch to fullscreen when user click on it
            fullscreen: true
        });
    });

    /*
     * we add a handler to manage "onStreamClosed" event triggered by the stream manager
     * this event occurs when a local or remote stream is closed
     */
     BistriConference.streams.addHandler("onStreamClosed", function (remoteStream, pid) {

        // we remove the video stream from the page
        BistriConference.detachStream(remoteStream);
    });

    // we open a session on the signaling server
    BistriConference.connect();

}
</script>
</body>
</html>
